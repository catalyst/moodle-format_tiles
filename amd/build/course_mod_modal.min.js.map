{"version":3,"sourceRoot":"..","sources":["server/course/format/tiles/amd/src/course_mod_modal.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/* global document, window */\n/* eslint space-before-function-paren: 0 */\n\n/**\n * Javascript Module to handle rendering of course modules (e.g. resource/PDF, resource/html, page) in modal windows\n *\n * When the user clicks a PDF course module subtile or old style resource\n * if we are using modals for it (e.g. PDF) , create, populate, launch and size the modal\n *\n * @module      course_mod_modal\n * @package     course/format\n * @subpackage  tiles\n * @copyright   2018 David Watson {@link http://evolutioncode.uk}\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since       Moodle 3.3\n */\n\ndefine([\"jquery\", \"core/modal_factory\", \"core/config\", \"core/templates\", \"core/notification\", \"core/ajax\"],\n    function ($, modalFactory, config, Templates, Notification, ajax) {\n        \"use strict\";\n\n        /**\n         * Keep references for all modals we have already added to the page,\n         * so that we can relaunch then if needed\n         * @type {{}}\n         */\n        var modalStore = {};\n        var loadingIconHtml;\n        var win = $(window);\n        var courseId;\n\n        var Selector = {\n            toggleCompletion: \".togglecompletion\",\n            modal: \".modal\",\n            modalDialog: \".modal-dialog\",\n            modalBody: \".modal-body\",\n            sectionMain: \".section.main\",\n            pageContent: \"#page-content\",\n            regionMain: \"#region-main\",\n            completionState: \"#completionstate_\",\n            cmModalClose: \".embed_cm_modal .close\",\n            cmModal: \".embed_cm_modal\",\n            moodleMediaPlayer: \".mediaplugin_videojs\",\n            urlModalLoadWarning: \"#embed-url-error-msg-\",\n            closeBtn: \"button.close\",\n            ACTIVITY: \"li.activity\",\n            URLACTIVITYPOPUPLINK: \".activity.modtype_url.urlpopup a\",\n            newWindowButton: \".button_expand\",\n            modalHeader: \".modal-header\",\n            embedModuleButtons: \".embed-module-buttons\"\n        };\n\n        var LaunchModalDataActions = {\n            launchResourceModal: \"launch-tiles-resource-modal\",\n            launchModuleModal: \"launch-tiles-module-modal\",\n            launchUrlModal: \"launch-tiles-url-modal\"\n        };\n\n        var modalMinWidth = function () {\n            return Math.min(win.width(), 1000);\n        };\n\n        /**\n         * Some modals contain videos in iframes or objects, which need to stop playing when dismissed.\n         * @param {object} modal the modal which contains the video.\n         */\n        var stopAllVideosOnDismiss = function(modal) {\n            var iframes = modal.find(\"iframe\");\n            if (iframes.length > 0) {\n                modal.find(Selector.closeBtn).click(function(e) {\n                    $(e.currentTarget).closest(Selector.cmModal).find(\"iframe\").each(function (index, iframe) {\n                        iframe = $(iframe);\n                        iframe.attr('src', iframe.attr(\"src\"));\n                    });\n                });\n            }\n            var objects = modal.find(\"object\");\n            if (objects.length > 0) {\n                // In this case resetting the URL does not seem to work so we clear it and clear modal from storage.\n                modal.find(Selector.closeBtn).click(function(e) {\n                    var modal = $(e.currentTarget).closest(Selector.cmModal);\n                    modal.find(\"object\").each(function (index, object) {\n                        object = $(object);\n                        object.attr('data', \"\");\n                    });\n                    modalStore[modal.attr(\"data-cmid\")] = undefined;\n                });\n            }\n\n            var moodleMediaPlayer = modal.find(Selector.moodleMediaPlayer);\n            if (moodleMediaPlayer.length > 0) {\n                modal.find(Selector.closeBtn).click(function() {\n                    modal.find(Selector.moodleMediaPlayer).html(\"\");\n                });\n                // Ensure we create a new modal next time.\n                modalStore[modal.attr(\"data-cmid\")] = undefined;\n            }\n        };\n\n        /**\n         * Launch a Course Resource Modal if we have it already, or make one and launch e.g. for PDF\n         * @param {object} clickedCmObject the course module object which was clicked\n         * @returns {boolean} if successful or not\n         */\n        var launchCourseResourceModal = function (clickedCmObject) {\n            var cmid = clickedCmObject.attr(\"data-cmid\");\n            modalFactory.create({\n                type: modalFactory.types.DEFAULT,\n                title: clickedCmObject.attr(\"data-title\"),\n                body: loadingIconHtml\n            }).done(function (modal) {\n                modalStore[cmid] = modal;\n                modal.setLarge();\n                modal.show();\n                var modalRoot = $(modal.root);\n                modalRoot.attr(\"id\", \"embed_mod_modal_\" + cmid);\n                modalRoot.attr(\"data-cmid\", cmid);\n                modalRoot.addClass(\"embed_cm_modal\");\n\n                // Render the modal body and set it to the page.\n                // First a blank template data object.\n                var templateData = {\n                    id: cmid,\n                    pluginfileUrl: clickedCmObject.attr(\"data-url\"),\n                    objectType: \"text/html\",\n                    width: \"100%\",\n                    height: Math.round(win.height() - 60), // Embedded object height in modal - make as high as poss.\n                    cmid: cmid,\n                    tileid: clickedCmObject.closest(Selector.sectionMain).attr(\"data-section\"),\n                    isediting: 0,\n                    sesskey: config.sesskey,\n                    modtitle: clickedCmObject.attr(\"data-title\"),\n                    config: {wwwroot: config.wwwroot},\n                    showDownload: 0,\n                    showNewWindow: 0,\n                    completionInUseForCm: 0\n                };\n\n                // If it's a PDF in this modal, change from the defaults assigned above.\n                if (clickedCmObject.attr('data-modtype') === \"resource_pdf\") {\n                    templateData.objectType = 'application/pdf';\n                    templateData.showDownload = 1;\n                    templateData.showNewWindow = 1;\n                }\n\n                Templates.render(\"format_tiles/embed_file_modal_body\", templateData).done(function (html) {\n                    modal.setBody(html);\n                    modalRoot.find(Selector.modalBody).animate({\"min-height\": Math.round(win.height() - 60)}, \"fast\");\n\n                    if (clickedCmObject.attr('data-modtype') === \"resource_html\") {\n                        // HTML files only - set widths to 100% since they may contain embedded videos etc.\n                        modalRoot.find(Selector.modal).animate({\"max-width\": \"100%\"}, \"fast\");\n                        modalRoot.find(Selector.modalDialog).animate({\"max-width\": \"100%\"}, \"fast\");\n                        modalRoot.find(Selector.modalBody).animate({\"max-width\": \"100%\"}, \"fast\");\n                        stopAllVideosOnDismiss(modalRoot);\n                    } else {\n                        // Otherwise (e.g for PDF) we don't need 100% width.\n                        modalRoot.find(Selector.modal).animate({\"max-width\": modalMinWidth()}, \"fast\");\n                        // We do modal-dialog too since Moove theme uses it.\n                        modalRoot.find(Selector.modalDialog).animate({\"max-width\": modalMinWidth()}, \"fast\");\n                    }\n\n                }).fail(Notification.exception);\n                // Render the modal header / title and set it to the page.\n                if (clickedCmObject.find(Selector.toggleCompletion).length !== 0) {\n                    var inverseCompletionState = parseInt(\n                        $(Selector.completionState + cmid).attr(\"value\")\n                    );\n                    templateData.completionInUseForCm = 1;\n                    templateData.completionstate = 1 - inverseCompletionState;\n                    templateData.completionicon = inverseCompletionState === 1 ? 'n' : 'y';\n                    templateData.completionstateInverse = inverseCompletionState;\n                    templateData.completionIsManual = clickedCmObject\n                        .find(Selector.toggleCompletion).attr(\"data-ismanual\");\n                }\n                Templates.render(\"format_tiles/embed_module_modal_header_btns\", templateData).done(function (html) {\n                    modalRoot.find(Selector.modalHeader).append(html);\n                    modalRoot.find(Selector.closeBtn).detach().appendTo(modalRoot.find(Selector.embedModuleButtons));\n                }).fail(Notification.exception);\n\n                return true;\n            });\n            return false;\n        };\n\n        /**\n         * Launch an embedded URL Modal (URL displays in iframe) if we have it already, or make one and launch.\n         * This is only used if the URL activity is set to Display: embed.  The reason is that most websites disallow iframes.\n         * See https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options.\n         * @param {object} clickedCmObject the course module object which was clicked\n         * @returns {boolean} if successful or not\n         */\n        var launchEmbeddedUrlModal = function (clickedCmObject) {\n            var cmid = clickedCmObject.attr(\"data-cmid\");\n            modalFactory.create({\n                type: modalFactory.types.DEFAULT,\n                title: clickedCmObject.attr(\"data-title\"),\n                body: loadingIconHtml\n            }).done(function (modal) {\n                modalStore[cmid] = modal;\n                modal.setLarge();\n                modal.show();\n                var modalRoot = $(modal.root);\n                modalRoot.attr(\"id\", \"embed_mod_modal_\" + cmid);\n                modalRoot.attr(\"data-cmid\", cmid);\n                modalRoot.addClass(\"embed_cm_modal\");\n\n                // Render the modal body and set it to the page.\n                // First a blank template data object.\n\n                var modalWidth = Math.round(win.width() * 0.9);\n                var modalHeight = Math.round(win.height() * 0.9);\n                var templateData = {\n                    id: cmid,\n                    pluginfileUrl: clickedCmObject.attr(\"data-url\"),\n                    objectType: \"text/html\",\n                    width: modalWidth - 30,\n                    height: modalHeight - 30,\n                    cmid: cmid,\n                    tileid: clickedCmObject.closest(Selector.sectionMain).attr(\"data-section\"),\n                    isediting: 0,\n                    sesskey: config.sesskey,\n                    modtitle: clickedCmObject.attr(\"data-title\"),\n                    config: {wwwroot: config.wwwroot},\n                    showDownload: 0,\n                    showNewWindow: 1,\n                    completionInUseForCm: 0,\n                    secondaryurl: clickedCmObject.closest(Selector.ACTIVITY).attr(\"data-url-secondary\")\n                };\n\n                Templates.render(\"format_tiles/embed_url_modal_body\", templateData).done(function (html) {\n                    modal.setBody(html);\n                    modalRoot.find(Selector.modalBody).animate({\"min-height\": modalHeight}, \"fast\");\n                    modalRoot.find(Selector.modal).animate({\"max-width\": modalWidth}, \"fast\");\n                    modalRoot.find(Selector.modalDialog).animate({\"max-width\": modalWidth}, \"fast\");\n                    modalRoot.find(Selector.modalBody).animate({\"max-width\": modalWidth}, \"fast\");\n                    stopAllVideosOnDismiss(modalRoot);\n                    modalRoot.find(Selector.modalBody).addClass(\"text-center\");\n                }).fail(Notification.exception);\n                // Render the modal header / title and set it to the page.\n                if (clickedCmObject.find(Selector.toggleCompletion).length !== 0) {\n                    var inverseCompletionState = parseInt(\n                        $(Selector.completionState + cmid).attr(\"value\")\n                    );\n                    templateData.completionInUseForCm = 1;\n                    templateData.completionstate = 1 - inverseCompletionState;\n                    templateData.completionicon = inverseCompletionState === 1 ? 'n' : 'y';\n                    templateData.completionstateInverse = inverseCompletionState;\n                    templateData.completionIsManual = clickedCmObject\n                        .find(Selector.toggleCompletion).attr(\"data-ismanual\");\n                }\n                Templates.render(\"format_tiles/embed_module_modal_header_btns\", templateData).done(function (html) {\n                    modalRoot.find(Selector.modalHeader).append(html);\n                    modalRoot.find(Selector.closeBtn).detach().appendTo(modalRoot.find(Selector.embedModuleButtons));\n                }).fail(Notification.exception);\n\n                // Listen to see if user clicks to view the modal contents in a new window.  Dismiss modal if so.\n                // Important for video which may end up playing twice otherwise.\n                setTimeout(function() {\n                    modalRoot.find(Selector.newWindowButton).click(function() {\n                        modalStore[modalRoot.attr(\"data-cmid\")] = undefined;\n                        modalRoot.remove();\n                        $(\".modal-backdrop\").not(\"#window-overlay\").removeClass(\"show\").addClass(\"hide\");\n                    });\n                }, 1000);\n\n                return true;\n            });\n            return false;\n        };\n\n        var resizeModal = function(modalRoot) {\n            modalRoot.find(Selector.modal).animate({\"max-width\": modalMinWidth()}, \"fast\");\n\n            var MODAL_MARGIN = 70;\n\n            // If the modal contains a Moodle mediaplayer div, remove the max width css rule which Moodle applies.\n            // Otherwise video will be 400px max wide.\n            var mediaPlayer = $(Selector.moodleMediaPlayer);\n            mediaPlayer.find(\"div\").each(function(index, child) {\n                $(child).css(\"max-width\", \"\");\n            });\n            if (mediaPlayer.length > 0) {\n                stopAllVideosOnDismiss(modalRoot);\n            }\n\n            // If the activity contains an iframe (e.g. is a page with a YouTube video in it), ensure modal is big enough.\n            // Do this for every iframe in the course module.\n            modalRoot.find(\"iframe\").each(function (index, iframe) {\n\n                // Get the modal.\n                var modal;\n                // Boost calls the modal \"modal dialog\" so try this first.\n                modal = modalRoot.find(Selector.modalDialog);\n\n                // If no luck, try what Clean and Adaptable do instead.\n                if (modal.length === 0) {\n                    modal = modalRoot.find(Selector.modal);\n                }\n\n                // Now check and adjust the width of the modal.\n                var iframeWidth = Math.min($(iframe).width(), win.width());\n                if (iframeWidth > modal.width() - MODAL_MARGIN) {\n                    modal.animate(\n                        {\"max-width\": Math.max(iframeWidth + MODAL_MARGIN, modalMinWidth())},\n                        \"fast\"\n                    );\n                    modalRoot.find(Selector.modal).animate(\n                        {\"max-width\": Math.max(iframeWidth + MODAL_MARGIN, modalMinWidth())},\n                        \"fast\"\n                    );\n                }\n\n                // Then the height of the modal body.\n                var iframeHeight = Math.min($(iframe).height(), win.height());\n                var modalBody = modalRoot.find(Selector.modalBody);\n                if (iframeHeight > modalBody.height() - MODAL_MARGIN) {\n                    modalBody.animate({\"min-height\": Math.min(iframeHeight + MODAL_MARGIN, win.height())}, \"fast\");\n                }\n\n                // Align the iframe in the centre of the modal.\n                modalBody.css(\"text-align\", \"center\");\n\n                stopAllVideosOnDismiss(modalRoot);\n            });\n        };\n\n        // TODO refactor these to avoid repetition.\n        /**\n         * Launch a Course activity Modal if we have it already, or make one and launch e.g. for \"Page\"\n         * @param {object} clickedCmObject the course module object which was clicked\n         * @returns {boolean} if successful or not\n         */\n        var launchCourseActivityModal = function (clickedCmObject) {\n            var cmid = clickedCmObject.attr(\"data-cmid\");\n            // TODO code envisages potentially adding in other web services for other mod types, but for now we have page only.\n            var methodName = \"format_tiles_get_mod_\" + clickedCmObject.attr(\"data-modtype\") + \"_html\";\n\n            modalFactory.create({\n                type: modalFactory.types.DEFAULT,\n                title: clickedCmObject.attr(\"data-title\"),\n                body: loadingIconHtml\n            }).done(function (modal) {\n                modalStore[cmid] = modal;\n                modal.setLarge();\n                modal.show();\n                var modalRoot = $(modal.root);\n                modalRoot.attr(\"data-cmid\", cmid);\n                modalRoot.attr(\"id\", \"embed_mod_modal_\" + cmid);\n                modalRoot.addClass(\"embed_cm_modal\");\n                modalRoot.addClass('mod_' + clickedCmObject.attr(\"data-modtype\"));\n                stopAllVideosOnDismiss(modalRoot);\n                ajax.call([{\n                    methodname: methodName,\n                    args: {\n                        courseid: courseId,\n                        cmid: cmid\n                    }\n                }])[0].done(function(response) {\n                    var templateData = {\n                        cmid: cmid,\n                        modtitle: clickedCmObject.attr(\"data-title\"),\n                        content: response.html\n                    };\n                    if (clickedCmObject.find(Selector.toggleCompletion).length !== 0) {\n                        var inverseCompletionState = parseInt(\n                            $(Selector.completionState + cmid).attr(\"value\")\n                        );\n                        templateData.completionInUseForCm = 1;\n                        templateData.completionstate = 1 - inverseCompletionState;\n                        templateData.completionstateInverse = inverseCompletionState;\n                        templateData.completionIsManual = clickedCmObject\n                            .find(Selector.toggleCompletion).attr(\"data-ismanual\");\n                        templateData.completionicon = inverseCompletionState === 1 ? 'n' : 'y';\n                    } else {\n                        templateData.completionInUseForCm = 0;\n                    }\n                    modal.setBody(templateData.content);\n                    Templates.render(\"format_tiles/embed_module_modal_header_btns\", templateData).done(function (html) {\n                        modalRoot.find(Selector.modalHeader).append(html);\n                        modalRoot.find(Selector.closeBtn).detach().appendTo(modalRoot.find(Selector.embedModuleButtons));\n                    }).fail(Notification.exception);\n\n                    resizeModal(modalRoot);\n\n                    return true;\n                }).fail(function(ex) {\n                    if (config.developerdebug !== true) {\n                        // Load the activity using PHP instead.\n                        window.location = config.wwwroot + \"/mod/\" + clickedCmObject.attr(\"data-modtype\") + \"/view.php?id=\" + cmid;\n                    } else {\n                        Notification.exception(ex);\n                    }\n                });\n            });\n            return false;\n        };\n\n        /**\n         * If a URL activity is clicked and it's been set to open in \"Pop up\" then launch a browser pop up.\n         * @param {object} e\n         */\n        var launchUrlPopUp = function (e) {\n            var clickedActivity = $(e.currentTarget).closest(Selector.ACTIVITY);\n            if (clickedActivity.attr(\"data-url\") !== undefined) {\n                e.stopPropagation();\n                e.preventDefault();\n                // Log the fact we viewed it.\n                ajax.call([{\n                    methodname: \"format_tiles_log_mod_view\", args: {\n                        courseid: courseId,\n                        cmid: clickedActivity.attr(\"data-cmid\")\n                    }\n                }])[0].done(function () {\n                    // Because we intercepted the normal event for the click, process auto completion.\n                    require([\"format_tiles/completion\"], function (completion) {\n                        completion.markAsAutoCompleteInUI(courseId, clickedActivity);\n                    });\n                    // Then open the pop up.\n                    var newWin = window.open(clickedActivity.attr(\"data-url\"));\n                    try {\n                        newWin.focus();\n                    } catch (e) {\n                        // Blocked pop-up?\n                        var popUpLink = '<div>'\n                            + '<a href=\"' + clickedActivity.attr(\"data-url\") + '\">'\n                            + clickedActivity.attr(\"data-url\")\n                            + '</a></div>';\n                        require(['core/str', 'core/notification'], function(Str, Notification) {\n                            var stringKeys = [\n                                {key: \"sectionerrortitle\", component: \"format_tiles\"},\n                                {key: \"blockedpopup\", component: \"format_tiles\"},\n                                {key: \"cancel\"}\n                            ];\n                            Str.get_strings(stringKeys).done(function (s) {\n                                Notification.alert(\n                                   s[0],\n                                    s[1] + popUpLink,\n                                    s[2]\n                                );\n                            });\n                        });\n                    }\n                }).fail(Notification.exception);\n            }\n        };\n\n        return {\n            init: function (courseIdInit, isEditing) {\n                courseId = courseIdInit;\n                $(document).ready(function () {\n                    var modalSelectors = Object.keys(LaunchModalDataActions).map(function (key) {\n                        return '[data-action=\"' + LaunchModalDataActions[key] + '\"]';\n                    }).join(\", \");\n\n                    var pageContent = $(Selector.pageContent);\n                    if (pageContent.length === 0) {\n                        // Some themes e.g. RemUI do not have a #page-content div, so use #region-main.\n                        pageContent = $(Selector.regionMain);\n                    }\n                    pageContent.on(\"click\", modalSelectors, function (e) {\n                        e.preventDefault();\n                        var tgt = $(e.currentTarget);\n                        var clickedCmObject = tgt.closest(\"li.activity\");\n\n                        // If we already have this modal on the page, launch it.\n                        var existingModal = modalStore[clickedCmObject.attr(\"data-cmid\")];\n                        if (typeof existingModal === \"object\") {\n                            existingModal.show();\n                        } else {\n                            // We don't already have it, so make it.\n                            switch (tgt.attr(\"data-action\")) {\n                                case LaunchModalDataActions.launchModuleModal:\n                                    launchCourseActivityModal(clickedCmObject);\n                                    break;\n                                case LaunchModalDataActions.launchResourceModal:\n                                    launchCourseResourceModal(clickedCmObject);\n                                    break;\n                                case LaunchModalDataActions.launchUrlModal:\n                                    launchEmbeddedUrlModal(clickedCmObject);\n                                    break;\n                                default:\n                                    throw new Error(\"Unknown modal type \" + tgt.attr(\"data-action\"));\n                            }\n                            // Log the fact we viewed it (only do this once not every time the modal launches).\n                            ajax.call([{\n                                methodname: \"format_tiles_log_mod_view\", args: {\n                                    courseid: courseId,\n                                    cmid: clickedCmObject.attr(\"data-cmid\")\n                                }\n                                }])[0].fail(Notification.exception);\n                        }\n                    });\n\n                     // Render the loading icon and append it to body so that we can use it later.\n                    Templates.render(\"format_tiles/loading\", {})\n                        .catch(Notification.exception)\n                        .done(function (html) {\n                            loadingIconHtml = html; // TODO get this from elsewhere.\n                        }).fail(Notification.exception);\n\n                    if (!isEditing) {\n                        // If a URL activity is clicked and it's been set to open in \"Pop up\" then launch a browser pop up.\n                        pageContent.on(\"click\", Selector.URLACTIVITYPOPUPLINK, function(e) {\n                            launchUrlPopUp(e);\n                        });\n                    }\n                });\n            }\n        };\n    }\n);\n"],"names":["define","$","modalFactory","config","Templates","Notification","ajax","modalStore","loadingIconHtml","win","window","courseId","Selector","toggleCompletion","modal","modalDialog","modalBody","sectionMain","pageContent","regionMain","completionState","cmModalClose","cmModal","moodleMediaPlayer","urlModalLoadWarning","closeBtn","ACTIVITY","URLACTIVITYPOPUPLINK","newWindowButton","modalHeader","embedModuleButtons","LaunchModalDataActions","launchResourceModal","launchModuleModal","launchUrlModal","modalMinWidth","Math","min","width","stopAllVideosOnDismiss","iframes","find","length","click","e","currentTarget","closest","each","index","iframe","attr","objects","object","undefined","html","launchCourseResourceModal","clickedCmObject","cmid","create","type","types","DEFAULT","title","body","done","setLarge","show","modalRoot","root","addClass","templateData","id","pluginfileUrl","objectType","height","round","tileid","isediting","sesskey","modtitle","wwwroot","showDownload","showNewWindow","completionInUseForCm","render","setBody","animate","min-height","max-width","fail","exception","inverseCompletionState","parseInt","completionstate","completionicon","completionstateInverse","completionIsManual","append","detach","appendTo","launchEmbeddedUrlModal","modalWidth","modalHeight","secondaryurl","setTimeout","remove","not","removeClass","resizeModal","MODAL_MARGIN","mediaPlayer","child","css","iframeWidth","max","iframeHeight","launchCourseActivityModal","methodName","call","methodname","args","courseid","response","content","ex","developerdebug","location","launchUrlPopUp","clickedActivity","stopPropagation","preventDefault","require","completion","markAsAutoCompleteInUI","newWin","open","focus","popUpLink","Str","stringKeys","key","component","get_strings","s","alert","init","courseIdInit","isEditing","document","ready","modalSelectors","Object","keys","map","join","on","tgt","existingModal","Error","catch"],"mappings":"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"}